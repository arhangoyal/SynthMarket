# \<SynthMarket> <br> Adaptive Synthetic Data Generation for Algorithm Testing in Financial Markets

Testing trading algorithms in financial markets requires data that represents realistic and diverse market conditions. However, relying on historical data has limitations: it is often expensive, biased, and inflexible for evolving algorithm needs. Synthetic data provides an alternative, but traditional methods lack adaptability and realism. Project report: [report.pdf](report.pdf)

## **Table of Contents**

1. [Running the Project](#running-the-project)
    - [Prerequisites](#prerequisites)
    - [General Instructions](#general-instructions)
    - [Visualization](#visualization)
    - [Market Participants Component](#market-participants-component)
    - [Regime-Switching Model Instructions](#regime-switching-model-instructions)
2. [Modules and Components](#modules-and-components)
    - [Data Generator](#data-generator)
    - [OrderBook Module](#orderbook-module)
    - [IntegratedDataGenerator.py](#integrateddatageneratorpy)
    - [simulator.py](#simulatorpy)
3. [Data Cleaning](#post-processing-data-cleaning)
4. [Backtester](#backtester)
    - [Usage](#usage)
    - [Data Format](#data-format)
    - [Creating New Strategies](#creating-new-strategies)
5. [Features](#features)
6. [Results Interpretation](#results-interpretation)
7. [References](#references)
8. [Contact Information](#contact-information)

---

## **Running the Project**

### **Prerequisites**

- **Python Version:** 3.9.6
- **Required Packages:** Listed in the [`requirements.txt`](requirements.txt) file. Install them using: `pip install -r requirements.txt`

### **General Instructions**

1. **Simulator:**

    The [`simulator.py`](simulation/simulator.py) script generates synthetic market data based on selected financial models.

    - **View Help:** `python -m simulation.simulator --help`

    - **Example Usage for the Heston Model:**

        ```bash
          python -m simulation.simulator --model heston --S0 100 --V0 0.04 --mu 0.05 --kappa 2.5 --theta 0.04 --sigma_v 0.3 --rho -0.5 --dt 0.003968253968253968 --T 1 --tick_size 0.01 --initial_depth 5 --max_volume 50 --price_step 0.01 --spread_limit 0.05 --depth_levels 5
        ```

    This command generates a CSV file in the `simulation_output` directory containing simulated price and order book data.

### **Visualization**

2. **Order Book Visualization:**

    To visualize the simulated order books, use the Streamlit application.

    - **Run the Streamlit App:** `streamlit run simulation/order_book_simulation.py`

    - **Usage:**
        - Upload the CSV file generated by the simulator from the `simulation_output` directory.
        - Use the slider to select different time steps and observe the order book's state.

### **Market Participants Component**

3. **Market Participants Simulation:**

    This component allows testing of different trading strategies in simulated market conditions.

    - **Features:**
        - Multiple trader types (Market Maker, Position Taker)
        - Performance metrics and analytics
        - Risk management frameworks
        - Detailed backtesting capabilities

    - **Complete Documentation:**
        - Refer to [`market_participants/README.md`](market_participants/README.md) for comprehensive details.

    - **Instructions to Run:**

        ```bash
        # From the market_participants_project directory:
        python tests/test_traders.py --data_file data/heston_tick_supported_30s_data.csv --strategy market_maker

        # Or from the root project directory:
        python market_participants_project/tests/test_traders.py --data_file market_participants_project/data/heston_tick_supported_30s_data.csv --strategy market_maker
        ```

    - **View Performance Metrics:**
        - Results are saved in the generated results file within the `market_participants_project` directory.

### **Regime-Switching Model Instructions**

4. **Regime-Switching Model:**

    The Regime-Switching Model simulates stock prices under different market regimes, such as bull and bear markets.

    - **General Case (Linux/Mac/Command Prompt):**

        ```bash
        python -m simulator.simulator --model regimeswitching --S0 515 --dt 0.0005787037 --T 1 --tick_size 0.01 --regimes "{\"bull\": {\"mu\": 0.10, \"sigma\": 0.20}, \"bear\": {\"mu\": -0.05, \"sigma\": 0.30}}" --transition_matrix "[[0.95,0.05],[0.10,0.90]]"
        ```

    - **Special Case (PowerShell):**

        ```bash
        python -m simulator.simulator --model regimeswitching --S0 515 --dt 0.0005787037 --T 1 --tick_size 0.01 --regimes '{\"bull\": {\"mu\": 0.10, \"sigma\": 0.20}, \"bear\": {\"mu\": -0.05, \"sigma\": 0.30}}' --transition_matrix '[[0.95,0.05],[0.10,0.90]]'
        ```

    - **Notes:**
        - **`--regimes` JSON Argument:** Specifies different market regimes with their parameters.

            ```json
            {
              "bull": {"mu": 0.10, "sigma": 0.20},
              "bear": {"mu": -0.05, "sigma": 0.30}
            }
            ```

        - **`--transition_matrix` JSON Argument:** Defines the probability of transitioning between regimes.

            ```json
            [[0.95, 0.05], [0.10, 0.90]]
            ```

    - **Debugging JSON Errors:**
        - Ensure proper syntax with double quotes for keys and values.
        - Validate JSON using tools like [JSONLint](https://jsonlint.com/).

<br> <br> 

---
<br> 

## **Modules and Components**

### **Data Generator**

The [`data_generator/`](data_generator) folder contains implementations of different stock price data generation models. These models simulate realistic financial market data for testing trading strategies, algorithms, or other market analysis tools. Mathematical and usage details for each model are outlined in [`data_generator/README.md`](data_generator/README.md).

#### **Contents:**

- [**BaseGenerator**](data_generator/BaseGenerator.py): Abstract base class defining a common interface for all data generators.
- [**HestonModel**](data_generator/HestonModel.py): Stochastic volatility model for simulating stock prices with time-varying volatility.
- [**JumpDiffusionModel**](data_generator/JumpDiffusionModel.py): Stock price model incorporating both continuous randomness and sudden jumps to mimic real-world price behavior.
- [**RegimeSwitchingModel**](data_generator/RegimeSwitchingModel.py): Simulates stock prices under different market regimes, such as bull and bear markets.
- [**VarianceGammaModel**](data_generator/VarianceGammaModel.py): Extends the Geometric Brownian Motion (GBM) model to incorporate skewness and kurtosis in return distributions.

The folder also contains testing scripts [test_models.py](data_generator/test_models.py) and [test_heston_day.py](data_generator/test_heston_day.py) to better understand model parameter usage.

### **OrderBook Module**

The [`OrderBook`](OrderBook/OrderBook.py) module manages bids and asks at different price levels, calculates the bid-ask spread, and provides market depth. It dynamically updates as price data changes, ensuring realistic market behavior in simulations.

### **IntegratedDataGenerator Module**

The [`IntegratedDataGenerator`](simulation/IntegratedDataGenerator.py) module generates synthetic market data using financial models and manages order book updates for realistic market simulations.

**Usage**: Instantiate the `IntegratedDataGenerator` class with the desired model and parameters, then call the `run_simulation()` method to generate data.

### **simulator.py**

The [`simulator.py`](simulation/simulator.py) script is the main interface for running synthetic market data simulations. It allows users to select a financial model and customize parameters like initial stock price, volatility, and order book settings using command-line arguments.

**Usage**: Run the script from the terminal with desired parameters. Example:

```bash
python -m simulator.simulator --model heston --S0 100 --V0 0.04 --mu 0.05 --kappa 2.5 --theta 0.04 --sigma_v 0.3 --rho -0.5 --dt 0.003968 --T 1 --tick_size 0.01 --initial_depth 5 --max_volume 50 --price_step 0.01 --spread_limit 0.05 --depth_levels 5
```

The output, including stock price data and order book updates, is saved in the `simulation_output` directory and is ready for visualization and backtesting.
<br> <br> 

---
<br> 

## **Post-Processing Data Cleaning**

To clean and format the generated CSV files, use the `CleanCSV.py` script. It automatically processes files in the `simulation_output` directory, removing unnecessary columns and standardizing the `Time` column into a `DateTime` format. This makes the data compatible with traditional backtesting tools like Strategy Studio. No additional input is requiredâ€”simply run the script to prepare your data for analysis.


## **Backtester**

Our backtester allows users to evaluate trading strategies against the generated synthetic market data.

### **Usage**

1. **Generate Synthetic Data:**

    - Use one of the models via `simulator.py` to generate simulation data.
    - Ensure the simulation runs to completion and the CSV file is saved in the `simulation_output` directory.

2. **Data Cleaning:**

    - Run `CleanCSV.py` to clean the data without needing to specify parameters: `python CleanCSV.py`
    - This will remove unwanted columns and convert the `Time` column to `DateTime`, preparing the data for backtesting.

3. **Configure Strategy Parameters:**

    - Open `run_backtest.py` and set your strategy parameters. Example:

        ```python
        parameters = {
            'position_limit': 100,
            'imbalance_threshold': 0.3,
            'trade_size': 1.0
        }
        ```

4. **Run the Backtest:** `python run_backtest.py`

### **Data Format**

The backtester expects Level 2 (L2) data in CSV format with the following columns:

- **DateTime:** Timestamp of the data point.
- **Price:** Mid price.
- **BidPrice_1..5:** Bid prices for levels 1-5.
- **BidSize_1..5:** Bid sizes for levels 1-5.
- **AskPrice_1..5:** Ask prices for levels 1-5.
- **AskSize_1..5:** Ask sizes for levels 1-5.
- **BidAskSpread:** Spread between the best bid and ask.

### **Creating New Strategies**

To develop custom trading strategies:

1. **Create a New Strategy Class:**

    - Navigate to the `strategies/` directory.
    - Create a new Python file, e.g., `my_strategy.py`, and define your strategy class inheriting from `StrategyBase`.

        ```python
        from backtester.backtesters.l2_backtester import StrategyBase

        class MyStrategy(StrategyBase):
            def __init__(self, parameters=None):
                super().__init__()
                self.parameters = parameters or {}
                
            def on_market_depth(self, market_depth):
                # Implement your strategy logic here
                pass
        ```

2. **Update `run_backtest.py` to Use Your Strategy:**

    ```python
    from strategies.my_strategy import MyStrategy
    strategy = MyStrategy(parameters)
    ```

3. **Run the Backtest:**

    ```bash
    python run_backtest.py
    ```

<br> <br> 

---
<br> 

## **Features**

- **Full L2 Orderbook Simulation:** Realistic depth and liquidity representation.
- **Realistic Order Execution with Market Impact:** Mimics real trading conditions.
- **Position Tracking and Risk Management:** Monitors and manages trading positions.
- **Performance Analytics:** Provides comprehensive metrics for strategy evaluation.
- **Extensible Strategy Framework:** Easily integrate and develop new trading strategies.



## **Results Interpretation**

The backtester provides several key metrics to evaluate strategy performance:

- **total_trades:** Number of executed trades during the simulation period.
- **final_position:** Net position at the end of the backtest (positive = long, negative = short).
- **avg_trade_size:** Average size of executed trades.
- **avg_price:** Average execution price across all trades.

**Example Output:**

```
Backtest Results:
total_trades: 34
final_position: -6.0
avg_trade_size: 1.0
avg_price: 118.81
```

*Interpretation:* The strategy executed 34 trades with consistent trade sizing (1.0), ending with a net short position of 6 units at an average execution price of \$118.81.


## **References**

1. Heston, S. L. (1993). A Closed-Form Solution for Options with Stochastic Volatility with Applications to Bond and Currency Options. *The Review of Financial Studies*, 6(2), 327-343.
2. Merton, R. C. (1976). Option Pricing when Underlying Stock Returns are Discontinuous. *Journal of Financial Economics*, 3(1-2), 125-144.
3. Hamilton, J. D. (1989). A New Approach to the Economic Analysis of Nonstationary Time Series and the Business Cycle. *Econometrica*, 57(2), 357-384.
4. Cont, R. (2001). Empirical Properties of Asset Returns: Stylized Facts and Statistical Issues. *Quantitative Finance*, 1(2), 223-236.


## **Contact Information**

For any questions or further assistance, please contact:

- **Sai Dasari:** saisd2@illinois.edu
- **Aryan Gosaliya:** aryanag2@illinois.edu
- **Arhan Goyal:** goyalarhan@gmail.com
- **Rutva Pandya:** rutvadp2@illinois.edu
